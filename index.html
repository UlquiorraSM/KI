<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Dungeon - Trinity Edition</title>
    <style>
        body { font-family: 'Courier New', Courier, monospace; background: #0d0d0d; color: #00ff41; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        #setup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .setup-box { background: #111; padding: 30px; border: 1px solid #00ff41; text-align: center; box-shadow: 0 0 15px #00ff41; }
        #log { flex: 1; overflow-y: auto; padding: 20px; display: none; line-height: 1.5; }
        #input-area { padding: 20px; display: none; gap: 10px; background: #000; border-top: 1px solid #00ff41; }
        input { flex: 1; padding: 12px; border: 1px solid #00ff41; background: #000; color: #00ff41; font-family: inherit; }
        button { padding: 10px 20px; background: #00ff41; border: none; color: #000; font-weight: bold; cursor: pointer; }
        button:disabled { background: #003300; color: #006600; }
        .thinking { color: #008800; font-style: italic; margin: 10px 0; }
        .user-text { color: #ffffff; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="setup-overlay">
        <div class="setup-box">
            <h2>TRINITY SYSTEM INITIALIZE</h2>
            <p>Bitte gib deinen OpenRouter API Key ein:</p>
            <input type="password" id="apiKeyInput" style="width: 80%; margin-bottom: 20px;" placeholder="sk-or-v1-...">
            <br>
            <button onclick="startGame()">System starten</button>
        </div>
    </div>

    <div id="log">SYSTEM: Trinity Large Preview aktiv. Das Abenteuer erwartet dich...</div>
    
    <div id="input-area">
        <input type="text" id="userInput" placeholder="Was tust du?" onkeydown="if(event.key==='Enter') sendToAI()">
        <button id="sendBtn" onclick="sendToAI()">Senden</button>
    </div>

    <script>
        let OPENROUTER_KEY = ""; 
        const MODEL_ID = "arcee-ai/trinity-large-preview"; // Dein gewünschtes Modell

        function startGame() {
            const val = document.getElementById('apiKeyInput').value.trim();
            if (val.startsWith("sk-or-")) {
                OPENROUTER_KEY = val;
                document.getElementById('setup-overlay').style.display = 'none';
                document.getElementById('log').style.display = 'block';
                document.getElementById('input-area').style.display = 'flex';
            } else {
                alert("Bitte einen gültigen OpenRouter Key eingeben.");
            }
        }

        async function sendToAI() {
            const inputField = document.getElementById('userInput');
            const log = document.getElementById('log');
            const sendBtn = document.getElementById('sendBtn');
            const userText = inputField.value.trim();

            if (!userText) return;

            inputField.disabled = true;
            sendBtn.disabled = true;
            log.innerHTML += `<div class="user-text">> ${userText}</div>`;
            inputField.value = "";
            
            const statusMsg = document.createElement("div");
            statusMsg.className = "thinking";
            statusMsg.innerText = "... Trinity berechnet Realität ...";
            log.appendChild(statusMsg);
            log.scrollTop = log.scrollHeight;

            try {
                // Hier nutzen wir jetzt die OpenRouter API Struktur
                const response = await fetch("https://openrouter.ai/v1/chat/completions", {
                    method: "POST",
                    headers: { 
                        "Authorization": `Bearer ${OPENROUTER_KEY}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.href, // OpenRouter möchte wissen, woher die Anfrage kommt
                        "X-Title": "AI Dungeon Trinity"
                    },
                    body: JSON.stringify({
                        "model": MODEL_ID,
                        "messages": [
                            { "role": "system", "content": "Du bist ein meisterhafter Game Master. Antworte auf Deutsch, sei atmosphärisch und kreativ." },
                            { "role": "user", "content": userText }
                        ],
                        "temperature": 0.8
                    })
                });

                const data = await response.json();
                statusMsg.remove();

                if (data.choices && data.choices[0].message) {
                    const aiText = data.choices[0].message.content;
                    log.innerHTML += `<div>${aiText.replace(/\n/g, '<br>')}</div>`;
                } else {
                    log.innerHTML += `<div style="color:red">Fehler: ${data.error ? data.error.message : "Unbekannter Fehler"}</div>`;
                }

            } catch (e) {
                statusMsg.remove();
                log.innerHTML += `<div style="color:red">Netzwerkfehler! Bist du online?</div>`;
                console.error(e);
            }

            inputField.disabled = false;
            sendBtn.disabled = false;
            inputField.focus();
            log.scrollTop = log.scrollHeight;
        }
    </script>
</body>
</html>
